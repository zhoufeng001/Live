<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zf.live.dao.mapper.VideoMapperExt" >
  <!--
  用于扩展com.zf.live.dao.mapper.VideoMapper接口
可通过com.zf.live.dao.mapper.VideoMapper.BaseResultMap 
和com.zf.live.dao.mapper.VideoMapper.Base_Column_List对其进行引用
by is_zhoufeng@163.com 2015-01-05 00:14:43.
  -->
  
  <select id="selectByCategory" parameterType="com.zf.live.client.vo.video.local.LocalVideoCategorySearchCondition" resultMap="com.zf.live.dao.mapper.VideoMapper.BaseResultMap">
	 <choose>
	 	<when test="categories.size() == 1">
	 		select 
	 		<include refid="com.zf.live.dao.mapper.VideoMapper.Base_Column_List"/>
	 		from `video`
	 		where category = "${categories.get(0)}"
			<if test="orderBy != null">
				order by ${orderBy}
			</if>
 			limit ${limitFrom},${limitLength}
	 	</when>
	 	<when test="categories.size() > 1">
			<foreach collection="categories"  index="idx"  item="item"  separator=" UNION ALL " >  
			 	(
			 		select 
			 		<include refid="com.zf.live.dao.mapper.VideoMapper.Base_Column_List"/>
			 		from `video`
			 		where category = "${item}"
					<if test="orderBy != null">
						order by ${orderBy}
					</if>
			 	)
			</foreach>
			<if test="orderBy != null">
				order by ${orderBy}
			</if>
			limit ${limitFrom},${limitLength}
		</when>
		<otherwise>
			select 
	 		<include refid="com.zf.live.dao.mapper.VideoMapper.Base_Column_List"/>
	 		from `video`
	 		<if test="orderBy != null">
				order by "${orderBy}"
			</if>
 			limit ${limitFrom},${limitLength}
		</otherwise>
	 </choose>
  </select>
  
  
  <select id="selectCountByCategory" parameterType="com.zf.live.client.vo.video.local.LocalVideoCategorySearchCondition" resultType="java.lang.Integer">
	 <choose>
	 	<when test="categories.size() == 1">
	 		select 
	 		count(*)
	 		from `video`
	 		where category = "${categories.get(0)}"
	 	</when>
	 	<when test="categories.size() > 1">
	 		select sum(cnt) from 
	 		(
				<foreach collection="categories"  index="idx"  item="item"  separator=" UNION ALL " >  
				 	(
				 		select 
				 		count(*) as cnt
				 		from `video`
				 		where category = "${item}"
				 	)
				</foreach>
			) tmp
		</when>
		<otherwise>
			select 
	 		count(*)
	 		from `video`
		</otherwise>
	 </choose>
  </select>
  
</mapper>
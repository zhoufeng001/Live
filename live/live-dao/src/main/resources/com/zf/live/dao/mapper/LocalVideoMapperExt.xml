<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zf.live.dao.mapper.LocalVideoMapperExt" >
  <!--
  用于扩展com.zf.live.dao.mapper.LocalVideoMapper接口
可通过com.zf.live.dao.mapper.LocalVideoMapper.BaseResultMap 
和com.zf.live.dao.mapper.LocalVideoMapper.Base_Column_List对其进行引用
by is_zhoufeng@163.com 2015-02-05 22:36:26.
  -->
  
  <!-- 观众数量列信息 -->
  <sql id="AUDIENCE_COUNT_COLOUM" >
    audience_count ,tourist_count,user_count 
  </sql>
  
  <resultMap id="ResultMapWithAudienceCountInfo" type="com.zf.live.dao.vo.video.LocalVideoVo" 
  	extends="com.zf.live.dao.mapper.LocalVideoMapper.ResultMapWithBLOBs" >
    <result column="audience_count" property="audienceCount" jdbcType="INTEGER" />
    <result column="tourist_count" property="touristCount" jdbcType="INTEGER" />
    <result column="user_count" property="userCount" jdbcType="INTEGER" />
  </resultMap>
  
  <insert id="saveToSpecificTable" parameterType="com.zf.live.dao.vo.video.LocalVideoVo" >
  	 insert into ${table} 
  	 <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="videofrom != null" >
        videofrom,
      </if>
      <if test="fromid != null" >
        fromid,
      </if>
      <if test="videoname != null" >
        videoname,
      </if>
      <if test="thumbnail != null" >
        thumbnail,
      </if>
      <if test="category != null" >
        category,
      </if>
      <if test="publishtime != null" >
        publishtime,
      </if>
      <if test="thirdPraise != null" >
        third_praise,
      </if>
      <if test="thirdViewCount != null" >
        third_view_count,
      </if>
      <if test="praise != null" >
        praise,
      </if>
      <if test="viewCount != null" >
        view_count,
      </if>
      <if test="flag != null" >
        flag,
      </if>
      <if test="groupId != null" >
        group_id,
      </if>
      <if test="groupSeq != null" >
        group_seq,
      </if>
      <if test="createtime != null" >
        createtime,
      </if>
      <if test="attr != null" >
        attr,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="videofrom != null" >
        #{videofrom,jdbcType=TINYINT},
      </if>
      <if test="fromid != null" >
        #{fromid,jdbcType=VARCHAR},
      </if>
      <if test="videoname != null" >
        #{videoname,jdbcType=VARCHAR},
      </if>
      <if test="thumbnail != null" >
        #{thumbnail,jdbcType=VARCHAR},
      </if>
      <if test="category != null" >
        #{category,jdbcType=VARCHAR},
      </if>
      <if test="publishtime != null" >
        #{publishtime,jdbcType=TIMESTAMP},
      </if>
      <if test="thirdPraise != null" >
        #{thirdPraise,jdbcType=BIGINT},
      </if>
      <if test="thirdViewCount != null" >
        #{thirdViewCount,jdbcType=BIGINT},
      </if>
      <if test="praise != null" >
        #{praise,jdbcType=BIGINT},
      </if>
      <if test="viewCount != null" >
        #{viewCount,jdbcType=BIGINT},
      </if>
      <if test="flag != null" >
        #{flag,jdbcType=INTEGER},
      </if>
      <if test="groupId != null" >
        #{groupId,jdbcType=BIGINT},
      </if>
      <if test="groupSeq != null" >
        #{groupSeq,jdbcType=INTEGER},
      </if>
      <if test="createtime != null" >
        #{createtime,jdbcType=TIMESTAMP},
      </if>
      <if test="attr != null" >
        #{attr,jdbcType=LONGVARCHAR},
      </if>
    </trim>
  </insert>
  
  <update id="updateByPrimaryKeySelectiveToSpecificTable"  parameterType="com.zf.live.dao.vo.video.LocalVideoVo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Feb 05 22:36:26 CST 2015.
    -->
    update ${table}
    <set >
      <if test="videofrom != null" >
        videofrom = #{videofrom,jdbcType=TINYINT},
      </if>
      <if test="fromid != null" >
        fromid = #{fromid,jdbcType=VARCHAR},
      </if>
      <if test="videoname != null" >
        videoname = #{videoname,jdbcType=VARCHAR},
      </if>
      <if test="thumbnail != null" >
        thumbnail = #{thumbnail,jdbcType=VARCHAR},
      </if>
      <if test="category != null" >
        category = #{category,jdbcType=VARCHAR},
      </if>
      <if test="publishtime != null" >
        publishtime = #{publishtime,jdbcType=TIMESTAMP},
      </if>
      <if test="thirdPraise != null" >
        third_praise = #{thirdPraise,jdbcType=BIGINT},
      </if>
      <if test="thirdViewCount != null" >
        third_view_count = #{thirdViewCount,jdbcType=BIGINT},
      </if>
      <if test="praise != null" >
        praise = #{praise,jdbcType=BIGINT},
      </if>
      <if test="viewCount != null" >
        view_count = #{viewCount,jdbcType=BIGINT},
      </if>
      <if test="flag != null" >
        flag = #{flag,jdbcType=INTEGER},
      </if>
      <if test="groupId != null" >
        group_id = #{groupId,jdbcType=BIGINT},
      </if>
      <if test="groupSeq != null" >
        group_seq = #{groupSeq,jdbcType=INTEGER},
      </if>
      <if test="createtime != null" >
        createtime = #{createtime,jdbcType=TIMESTAMP},
      </if>
      <if test="attr != null" >
        attr = #{attr,jdbcType=LONGVARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=VARCHAR}
  </update>
  
  <select id="selectByExampleFromSpecificTable" resultMap="ResultMapWithAudienceCountInfo" 
  		parameterType="com.zf.live.dao.pojo.vo.video.LocalVideoExampleVo" >
  	select 
  	 <include refid="com.zf.live.dao.mapper.LocalVideoMapper.Base_Column_List" />
    ,
    <include refid="com.zf.live.dao.mapper.LocalVideoMapper.Blob_Column_List" />
    ,
    <include refid="AUDIENCE_COUNT_COLOUM" />
  	from (
	    select
	    <include refid="com.zf.live.dao.mapper.LocalVideoMapper.Base_Column_List" />
	    ,
	    <include refid="com.zf.live.dao.mapper.LocalVideoMapper.Blob_Column_List" />
	    from ${table} 
	    <if test="_parameter != null" >
	      <include refid="com.zf.live.dao.mapper.LocalVideoMapper.Example_Where_Clause" />
	    </if>
	    <if test="orderByClause != null" >
	      order by ${orderByClause}
	    </if>
	    <if test="page != null" >
	      limit #{page.begin} , #{page.length}
	    </if>
     ) v left join audience_count ac on v.id = ac.vid
  </select>
  
  <select id="countByExample" parameterType="com.zf.live.dao.pojo.vo.video.LocalVideoExampleVo" resultType="java.lang.Integer" >
	   select count(*) from ${table}
	   <if test="_parameter != null" >
	     <include refid="com.zf.live.dao.mapper.LocalVideoMapper.Example_Where_Clause" />
	   </if>
  </select>
  
   <select id="selectByCategoryOrderByAudienceCount" resultMap="ResultMapWithAudienceCountInfo" >
  	select 
  	 <include refid="com.zf.live.dao.mapper.LocalVideoMapper.Base_Column_List" />
    ,
    <include refid="com.zf.live.dao.mapper.LocalVideoMapper.Blob_Column_List" />
    ,
    <include refid="AUDIENCE_COUNT_COLOUM" />
  	from (
	    select
	    <include refid="AUDIENCE_COUNT_COLOUM" />,vid
	    from audience_count
	    where video_category = #{category}
	    order by audience_count desc
	    limit #{begin} , #{length}
     ) ac left join ${table} v on ac.vid = v.id
  </select>
  
  <select id="countByCategoryFromAudienceCounte" resultType="java.lang.Integer" >
	   select count(*) from audience_count
	   where video_category = #{category} 
  </select>
  
  <select id="selectFromSpecificTableById" resultMap="ResultMapWithAudienceCountInfo">
  	 select 
  	 <include refid="com.zf.live.dao.mapper.LocalVideoMapper.Base_Column_List" />
     ,
     <include refid="com.zf.live.dao.mapper.LocalVideoMapper.Blob_Column_List" />
     ,
     <include refid="AUDIENCE_COUNT_COLOUM" />
  	 from
  	 ${table} v
  	 left join audience_count ac on v.id = ac.vid
  	 where v.id = #{id,jdbcType=VARCHAR}
  </select>
  
</mapper>